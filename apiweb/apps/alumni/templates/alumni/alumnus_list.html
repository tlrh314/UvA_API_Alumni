{% extends "base.html" %}
{% load bootstrap3 %}
{% load template_filters %}

{% block stylesheets %} {{ block.super }} {% endblock stylesheets %}

{% block title %}API - Research - Theses{% endblock title %}

{% block content %}

<div class="main-content" role="main">
    {% bootstrap_messages %}

    {# Filters #}
    {# TODO: margin auto 0 to center #}
    <div class="col-md-12 text-center">
        <ul class="nav nav-pills selector-nav center-pills">  
            {# Degree type dropdown menu #}
            {% get_degree_types as degrees %}
            <li role="presentation" class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
                    aria-expanded="false">Degree Type <span class="caret"></span>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="{% filter_objects 'type' 'None' %}"><i> No filter </i></a></li>
                    {% for type in degrees %}
                    {# Reset possible old filter and add store filter #}
                    <li>
                        <a href="{% filter_objects 'type' type.0 %}" class="menu-link"> 
                            <div class="menu-text"> {{ type.1 }} </div>
                            <img class="check-box" src="{% check_dropdown 'type' type.0 %}">
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </li>

            {# Defence year dropdown menu #}
            {% get_defence_years as years %}
            <li role="presentation" class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
                    aria-expanded="false">Year <span class="caret"></span>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="{% filter_objects 'year' 'None' %}"><i> No filter </i></a></li>
                    {% for year in years %}
                    {# Reset possible old filter and add store filter #}
                    <li>
                        <a href="{% filter_objects 'year' year.1 %}" class="menu-link"> 
                            <div class="menu-text"> {{ year.0 }} </div>
                            <img class="check-box" src="{% check_dropdown 'year' year.1 %}">
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </li>

        </ul>
    </div>
    {# End Filters #}

    <div class="col-xs-12 filter-col">
        {% get_active_filters as active_filters %}

        {# Reset all filters button #}
        {% if active_filters %}
            <a class="dropdown-toggle" href="{% url 'alumni:alumnus-list' %}" aria-haspopup="true" aria-expanded="false"> 
                <button type="button" class="btn btn-danger">
                    Reset All Filters <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                </button>
            </a>
        {% endif %}

        {# Display button for active filters #}
        {% for filter_type, filter_value in active_filters %}
        <a href="{% filter_objects filter_type filter_value %}">
            <button type="button" class="btn btn-danger filter-btn" href="#">
                {% if filter_type == "year" %}
                {% get_yearrange filter_value as yearrange %}
                    {{ filter_type }}s: {{ yearrange }} <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                {% else %}
                    {{ filter_type }}: {{ filter_value }} <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                {% endif %}
            </button>
        </a>
        {% endfor %}
    </div>

    <table class="table table-hover">
        <thead>
            <tr>
                <th>Alumnus</th>
                <th> MSc </th>
                <th> PhD  </th>
            </tr>
        </thead>
        <tbody>
            {% include "alumni/alumnus_paginator.html" %}
            {# Add the content #}
            <h2 class="text-center">Total number of alumni: {{ alumni.paginator.count }}</h2>
            {% for alumnus in alumni %}
            <tr class="{% cycle '' 'info' %}">
                <td><a href="{% url 'alumni:alumnus-detail' alumnus.slug %}">{{ alumnus.full_name }}</a></td>
                    <td> 
                    {% for degree in alumnus.degrees.all %}
                        {% if degree.type == 'msc'%}
                            {{ degree.date_stop|date:"Y" }} 
                        {% endif %}
                    {% endfor %}
                    </td>
                    <td>
                    {% for degree in alumnus.degrees.all %}
                        {% if degree.type == 'phd'%}
                            {{ degree.date_of_defence|date:"Y" }} 
                        {% endif %}
                    {% endfor %}
                    </td>
                    <td> </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    {% include "alumni/alumnus_paginator.html" %}
    <div class="col-xs-12" style="height:150px;"></div>
</div>


{% endblock content %}
