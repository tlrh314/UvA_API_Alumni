{% extends "base.html" %}

{% load template_filters %}

{% block stylesheets %} {{ block.super }} {% endblock stylesheets %}

{% block title %}API - Research - Theses{% endblock title %}

{% block content %}


<h1 class="text-center">{{ thesis_title }}</h1>


<div class="main-content" role="main"">

    <h2 class="text-center">Search returned {{ alumni.count }} results</h2>

    <table class="table table-hover">
        <thead>
            <tr>
                <th>Alumnus</th>
                <th>Thesis title </th>
                <th> MSc </th>
                <th> PhD  </th>
            </tr>
        </thead>
        <tbody>
        {% for alumnus in alumni %}
        <tr class="{% cycle '' 'info' %}">
            <td><a href="{% url 'alumni:alumnus-detail' alumnus.slug %}">{{ alumnus.full_name }}</a></td>
                <td>
                {% for degree in alumnus.degrees.all %}
                    <a href="{% url 'alumni:thesis-detail' thesis.thesis_slug %}">{{ degree.thesis_title }} </a><br>
                {% endfor %}

                </td>
                <td> 
                {% for degree in alumnus.degrees.all %}
                    {% if degree.type == 'msc'%}
                        {{ degree.date_stop|date:"Y" }} 
                    {% endif %}
                {% endfor %}
                </td>
                <td>
                {% for degree in alumnus.degrees.all %}
                    {% if degree.type == 'phd'%}
                        {{ degree.date_of_defence|date:"Y" }} 
                    {% endif %}
                {% endfor %}
                </td>
                <td> </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>


<script type="text/javascript"> 
    {% comment %}
    The following JS code is for highlighting the search keywords. 
    It is adapted from 'http://jsfiddle.net/crgTU/7/'.
    {% endcomment %}
    {% for word in key_words %}
    highlightWord(document.body,'{{ word }}');
    {% endfor %}
    /**
     * Highlight words from search
     */
    function highlightWord(root,word){
      textNodesUnder(root).forEach(highlightWords);

      function textNodesUnder(root){
        var walk=document.createTreeWalker(root,NodeFilter.SHOW_TEXT,null,false),
            text=[], node;
        while(node=walk.nextNode()) text.push(node);
        return text;
      }
        
      function highlightWords(n){
        for (var i; (i=n.nodeValue.toLowerCase().indexOf(word,i)) > -1; n=after){
          var after = n.splitText(i+word.length);
          var highlighted = n.splitText(i);
          var span = document.createElement('span');
          span.className = 'highlighted';
          span.appendChild(highlighted);
          after.parentNode.insertBefore(span,after);
        }
      }
    }

</script>


{% endblock content %}

